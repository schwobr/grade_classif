---

title: Reading data 


keywords: fastai
sidebar: home_sidebar

summary: "Defines utilities function for reading and manipulating data."
description: "Defines utilities function for reading and manipulating data."
nb_path: "nbs/10_data.read.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_data.read.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;sample_data/Patches_MGI_256_7&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_items" class="doc_header"><code>get_items</code><a href="https://github.com/schwobr/grade_classif/tree/master/grade_classif/data/read.py#L26" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_items</code>(<strong><code>folder</code></strong>:<code>Union</code>[<code>Path</code>, <code>str</code>], <strong><code>label_func</code></strong>:<code>Callable</code>[<code>Path</code>, <code>bool</code>], <strong><code>recurse</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>extensions</code></strong>:<code>Optional</code>[<code>Sequence</code>[<code>str</code>]]=<em><code>None</code></em>, <strong><code>include</code></strong>:<code>Optional</code>[<code>Sequence</code>[<code>str</code>]]=<em><code>None</code></em>, <strong><code>exclude</code></strong>:<code>Optional</code>[<code>Sequence</code>[<code>str</code>]]=<em><code>None</code></em>, <strong><code>filterfunc</code></strong>:<code>Optional</code>[<code>Callable</code>[<code>Path</code>, <code>bool</code>]]=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Loads all items and labels in <code>folder</code>. Items are stored as <code>Path</code> objects. Labels are computed for each item using <code>label_func</code>. By default, the search will happen recursively in all subfolders. To disable this behaviour, use <code>recurse=False</code>. You can also specify a list of <code>extensions</code> to restrict the accepted files, as well as <code>include</code> and <code>exclude</code> folders (as <code>str</code>, these are direct subfolders of <code>folder</code>). <code>filterfunc</code> can be used to only accept objects for which it returns <code>True</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">get_items</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
<span class="n">items</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">labels</span><span class="p">[::</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>([PosixPath(&#39;/home/DeepLearning/grade_classif/nbs/sample_data/Patches_MGI_256_7/1/CF_PACS04rescan_07P0201/CF_PACS04rescan_07P0201_32768_98304.png&#39;),
  PosixPath(&#39;/home/DeepLearning/grade_classif/nbs/sample_data/Patches_MGI_256_7/1/CF_PACS05HE_03026-04H2669/CF_PACS05HE_03026-04H2669_0_131072.png&#39;),
  PosixPath(&#39;/home/DeepLearning/grade_classif/nbs/sample_data/Patches_MGI_256_7/1/CF_PACS04rescan_07P0208/CF_PACS04rescan_07P0208_32768_98304.png&#39;),
  PosixPath(&#39;/home/DeepLearning/grade_classif/nbs/sample_data/Patches_MGI_256_7/1/CF_PACS04rescan_06P1306/CF_PACS04rescan_06P1306_0_98304.png&#39;),
  PosixPath(&#39;/home/DeepLearning/grade_classif/nbs/sample_data/Patches_MGI_256_7/3/CF_PACS04rescan_06P242/CF_PACS04rescan_06P242_0_98304.png&#39;),
  PosixPath(&#39;/home/DeepLearning/grade_classif/nbs/sample_data/Patches_MGI_256_7/3/CF_PACS05HE_08034-A03.11622B3/CF_PACS05HE_08034-A03.11622B3_32768_65536.png&#39;),
  PosixPath(&#39;/home/DeepLearning/grade_classif/nbs/sample_data/Patches_MGI_256_7/3/CF_PACS05HE_06003-172.608I/CF_PACS05HE_06003-172.608I_32768_98304.png&#39;),
  PosixPath(&#39;/home/DeepLearning/grade_classif/nbs/sample_data/Patches_MGI_256_7/3/CF_PACS05HE_06003-172.608I/CF_PACS05HE_06003-172.608I_0_98304.png&#39;)],
 [&#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;1&#39;, &#39;3&#39;, &#39;3&#39;, &#39;3&#39;, &#39;3&#39;])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_scan" class="doc_header"><code>get_scan</code><a href="https://github.com/schwobr/grade_classif/tree/master/grade_classif/data/read.py#L53" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_scan</code>(<strong><code>folder</code></strong>:<code>Union</code>[<code>Path</code>, <code>str</code>], <strong><code>scan_name</code></strong>:<code>str</code>, <strong><code>include</code></strong>:<code>Optional</code>[<code>Sequence</code>[<code>str</code>]]=<em><code>None</code></em>, <strong><code>exclude</code></strong>:<code>Optional</code>[<code>Sequence</code>[<code>str</code>]]=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Return a <code>Path</code> object to the folder corresponding to a <code>scan</code> name in a specific <code>folder</code>. Direct subfolders can be include or excluded using respectively <code>include</code> and <code>exclude</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_scan</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;CF_PACS05HE_08034-A03.11622B3&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>PosixPath(&#39;/home/DeepLearning/grade_classif/nbs/sample_data/Patches_MGI_256_7/3/CF_PACS05HE_08034-A03.11622B3&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split" class="doc_header"><code>split</code><a href="https://github.com/schwobr/grade_classif/tree/master/grade_classif/data/read.py#L72" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split</code>(<strong><code>scans</code></strong>:<code>Sequence</code>[<code>str</code>], <strong><code>grades</code></strong>:<code>Sequence</code>[<code>str</code>], <strong><code>valid_pct</code></strong>:<code>float</code>=<em><code>0.2</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using a list of scan names <code>scans</code>, a list of grades <code>grades</code> (both as strings) and ratio for the validation set's size <code>valid_pct</code>, randomly splits the dataset between training and validation sets. Returns a list of <code>'train'</code> and <code>'valid'</code> strings so that each scan is associated to a set.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">scans</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span>
<span class="n">grades</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;3&quot;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">70</span><span class="p">)]</span>
<span class="n">splits</span> <span class="o">=</span> <span class="n">split</span><span class="p">(</span><span class="n">scans</span><span class="p">,</span> <span class="n">grades</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;scan&quot;</span><span class="p">:</span> <span class="n">scans</span><span class="p">,</span> <span class="s2">&quot;grade&quot;</span><span class="p">:</span> <span class="n">grades</span><span class="p">,</span> <span class="s2">&quot;split&quot;</span><span class="p">:</span> <span class="n">splits</span><span class="p">})</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>scan</th>
      <th>grade</th>
      <th>split</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>valid</td>
    </tr>
    <tr>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>train</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>valid</td>
    </tr>
    <tr>
      <td>3</td>
      <td>3</td>
      <td>1</td>
      <td>train</td>
    </tr>
    <tr>
      <td>4</td>
      <td>4</td>
      <td>1</td>
      <td>train</td>
    </tr>
    <tr>
      <td>5</td>
      <td>5</td>
      <td>1</td>
      <td>train</td>
    </tr>
    <tr>
      <td>6</td>
      <td>6</td>
      <td>1</td>
      <td>train</td>
    </tr>
    <tr>
      <td>7</td>
      <td>7</td>
      <td>1</td>
      <td>train</td>
    </tr>
    <tr>
      <td>8</td>
      <td>8</td>
      <td>1</td>
      <td>train</td>
    </tr>
    <tr>
      <td>9</td>
      <td>9</td>
      <td>1</td>
      <td>train</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;split&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;valid&quot;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>20</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Proportions of grades 1 and 3 are preserved in each subset as you can see below.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;split&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;valid&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;grade&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;3&quot;</span><span class="p">)])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;split&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;valid&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.7</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_csv" class="doc_header"><code>create_csv</code><a href="https://github.com/schwobr/grade_classif/tree/master/grade_classif/data/read.py#L103" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_csv</code>(<strong><code>csv_path</code></strong>:<code>Path</code>, <strong><code>data_path</code></strong>:<code>Path</code>, <strong><code>label_func</code></strong>:<code>Optional</code>[<code>Callable</code>[<code>Path</code>, <code>bool</code>]]=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Creates a csv that contains all scan names, with the associated grade and subset they are in. Scans are found in the folder contained in <code>data_path</code> (<code>Path</code> object). Doubles are deleted. The file is then stored in <code>csv_path</code>. You can specify a <code>label_func</code> to compute how the grade is to be extracted from the path to a patch. Returns the corresponding dataframe.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">create_csv</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;sample.csv&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>scan</th>
      <th>grade</th>
      <th>split</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CF_PACS04rescan_07P0208</td>
      <td>1</td>
      <td>train</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CF_PACS05HE_03026-04H2669</td>
      <td>1</td>
      <td>valid</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CF_PACS04rescan_06P1306</td>
      <td>1</td>
      <td>train</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CF_PACS04rescan_07P0201</td>
      <td>1</td>
      <td>train</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CF_PACS05HE_06003-172.608I</td>
      <td>3</td>
      <td>train</td>
    </tr>
    <tr>
      <th>5</th>
      <td>CF_PACS05HE_08034-A03.11622B3</td>
      <td>3</td>
      <td>train</td>
    </tr>
    <tr>
      <th>6</th>
      <td>CF_PACS04rescan_06P242</td>
      <td>3</td>
      <td>valid</td>
    </tr>
    <tr>
      <th>7</th>
      <td>CF_PACS04rescan_06P0912</td>
      <td>3</td>
      <td>train</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

